# ESPHome LVGL Scale Widget Examples
# =============================================================================
# LVGL v9.4 Scale Widget - Complete Examples
#
# Scale Modes:
#   - ROUND_OUTER: Circular with ticks outside
#   - ROUND_INNER: Circular with ticks inside
#   - HORIZONTAL_TOP: Horizontal with ticks on top
#   - HORIZONTAL_BOTTOM: Horizontal with ticks on bottom
#   - VERTICAL_LEFT: Vertical with ticks on left
#   - VERTICAL_RIGHT: Vertical with ticks on right
#
# IMPORTANT: Scale widget only displays ticks and labels (static).
# For animated gauges, combine Scale + Arc widgets.
#
# Actions:
#   - lvgl.scale.update: Update scale properties
#   - lvgl.scale.section.update: Update section color/range
# =============================================================================

globals:
  # Animation counters for gauges
  - id: speed_value
    type: int
    initial_value: "0"
  - id: speed_direction
    type: int
    initial_value: "1"
  - id: temp_value
    type: int
    initial_value: "20"
  - id: pressure_value
    type: int
    initial_value: "5"

# =============================================================================
# SENSORS - Home Assistant Integration
# =============================================================================
sensor:
  - platform: homeassistant
    id: ha_temperature
    entity_id: sensor.temperature
    on_value:
      then:
        - lvgl.arc.update:
            id: temp_arc
            value: !lambda 'return (int)id(ha_temperature).state;'
            animated: true
        - lvgl.label.update:
            id: temp_value_label
            text:
              format: "%.1f째C"
              args: [id(ha_temperature).state]

  - platform: homeassistant
    id: ha_humidity
    entity_id: sensor.humidity
    on_value:
      then:
        - lvgl.arc.update:
            id: humidity_arc
            value: !lambda 'return (int)id(ha_humidity).state;'
            animated: true
        - lvgl.label.update:
            id: humidity_value_label
            text:
              format: "%.0f%%"
              args: [id(ha_humidity).state]

# =============================================================================
# ANIMATIONS - Demo gauges without sensors
# =============================================================================
interval:
  # Speedometer animation (50ms)
  - interval: 50ms
    then:
      - lambda: |-
          id(speed_value) += id(speed_direction) * 2;
          if (id(speed_value) >= 200) id(speed_direction) = -1;
          if (id(speed_value) <= 0) id(speed_direction) = 1;
      - lvgl.arc.update:
          id: speed_arc
          value: !lambda 'return id(speed_value);'
          animated: true
      - lvgl.label.update:
          id: speed_value_label
          text:
            format: "%d"
            args: [id(speed_value)]
      # Change color based on speed zone
      - if:
          condition:
            lambda: 'return id(speed_value) > 160;'
          then:
            - lvgl.widget.update:
                id: speed_arc
                indicator:
                  arc_color: 0xFF0000
          else:
            - if:
                condition:
                  lambda: 'return id(speed_value) > 120;'
                then:
                  - lvgl.widget.update:
                      id: speed_arc
                      indicator:
                        arc_color: 0xFFFF00
                else:
                  - lvgl.widget.update:
                      id: speed_arc
                      indicator:
                        arc_color: 0x00FF00

  # Temperature gauge animation (200ms)
  - interval: 200ms
    then:
      - lambda: |-
          id(temp_value) = -10 + (rand() % 50);
      - lvgl.arc.update:
          id: demo_temp_arc
          value: !lambda 'return id(temp_value);'
          animated: true
      - lvgl.label.update:
          id: demo_temp_value_label
          text:
            format: "%d째C"
            args: [id(temp_value)]

  # Pressure gauge animation (300ms)
  - interval: 300ms
    then:
      - lambda: |-
          id(pressure_value) = rand() % 11;
      - lvgl.arc.update:
          id: pressure_arc
          value: !lambda 'return id(pressure_value);'
          animated: true
      - lvgl.label.update:
          id: pressure_value_label
          text:
            format: "%d bar"
            args: [id(pressure_value)]

# =============================================================================
# LVGL CONFIGURATION
# =============================================================================
lvgl:
  displays:
    - display_id: my_display
      pages:
        # =====================================================================
        # PAGE 1: Speedometer Gauge (ROUND_OUTER)
        # =====================================================================
        - id: speedometer_page
          bg_color: 0x0a0a14
          widgets:
            - label:
                x: 20
                y: 10
                text: "Speedometer (Scale + Arc)"
                text_color: 0xFFFFFF
                text_font: montserrat_18

            # Scale for tick marks and labels
            - scale:
                id: speed_scale
                align: CENTER
                width: 280
                height: 280
                mode: ROUND_OUTER
                min_value: 0
                max_value: 200
                rotation: 135
                angle_range: 270
                ticks:
                  count: 21
                  width: 2
                  length: 10
                  color: 0x404040
                  major:
                    stride: 2
                    width: 4
                    length: 20
                    color: 0xFFFFFF
                    label_show: true
                    label_gap: 12
                sections:
                  # Green zone (0-120 km/h)
                  - id: speed_safe
                    range_from: 0
                    range_to: 120
                    color: 0x00FF00
                    width: 6
                  # Yellow zone (120-160 km/h)
                  - id: speed_caution
                    range_from: 120
                    range_to: 160
                    color: 0xFFFF00
                    width: 6
                  # Red zone (160-200 km/h)
                  - id: speed_danger
                    range_from: 160
                    range_to: 200
                    color: 0xFF0000
                    width: 6

            # Arc for animated indicator
            - arc:
                id: speed_arc
                align: CENTER
                width: 220
                height: 220
                min_value: 0
                max_value: 200
                value: 0
                rotation: 135
                bg_start_angle: 0
                bg_end_angle: 270
                mode: NORMAL
                arc_width: 20
                indicator:
                  arc_color: 0x00FF00
                  arc_width: 20
                bg_arc_color: 0x1a1a2e

            # Speed value display
            - label:
                id: speed_value_label
                align: CENTER
                y: 20
                text: "0"
                text_color: 0x00FF00
                text_font: montserrat_36

            - label:
                align: CENTER
                y: 55
                text: "km/h"
                text_color: 0x808080
                text_font: montserrat_14

        # =====================================================================
        # PAGE 2: Temperature & Humidity Gauges (Dual ROUND_INNER)
        # =====================================================================
        - id: climate_page
          bg_color: 0x0a0a14
          widgets:
            - label:
                x: 20
                y: 10
                text: "Climate Monitor"
                text_color: 0xFFFFFF
                text_font: montserrat_18

            # Temperature Scale (Left)
            - scale:
                id: temp_scale
                x: 30
                y: 60
                width: 200
                height: 200
                mode: ROUND_INNER
                min_value: -20
                max_value: 50
                rotation: 135
                angle_range: 270
                ticks:
                  count: 15
                  width: 2
                  length: 8
                  color: 0x404040
                  major:
                    stride: 3
                    width: 3
                    length: 15
                    color: 0xFFFFFF
                    label_show: true
                    label_gap: 8
                sections:
                  - id: temp_cold
                    range_from: -20
                    range_to: 10
                    color: 0x00BFFF
                    width: 5
                  - id: temp_comfort
                    range_from: 10
                    range_to: 28
                    color: 0x00FF00
                    width: 5
                  - id: temp_hot
                    range_from: 28
                    range_to: 50
                    color: 0xFF4500
                    width: 5

            - arc:
                id: demo_temp_arc
                x: 55
                y: 85
                width: 150
                height: 150
                min_value: -20
                max_value: 50
                value: 20
                rotation: 135
                bg_start_angle: 0
                bg_end_angle: 270
                mode: NORMAL
                arc_width: 12
                indicator:
                  arc_color: 0x00FF00
                  arc_width: 12
                bg_arc_color: 0x1a1a2e

            - label:
                id: demo_temp_value_label
                x: 80
                y: 155
                width: 100
                text_align: CENTER
                text: "20째C"
                text_color: 0x00FF00
                text_font: montserrat_20

            # Humidity Scale (Right)
            - scale:
                id: humidity_scale
                x: 250
                y: 60
                width: 200
                height: 200
                mode: ROUND_INNER
                min_value: 0
                max_value: 100
                rotation: 135
                angle_range: 270
                ticks:
                  count: 11
                  width: 2
                  length: 8
                  color: 0x404040
                  major:
                    stride: 2
                    width: 3
                    length: 15
                    color: 0xFFFFFF
                    label_show: true
                    label_gap: 8
                sections:
                  - id: humid_dry
                    range_from: 0
                    range_to: 30
                    color: 0xFFAA00
                    width: 5
                  - id: humid_comfort
                    range_from: 30
                    range_to: 60
                    color: 0x00FF00
                    width: 5
                  - id: humid_wet
                    range_from: 60
                    range_to: 100
                    color: 0x00BFFF
                    width: 5

            - arc:
                id: humidity_arc
                x: 275
                y: 85
                width: 150
                height: 150
                min_value: 0
                max_value: 100
                value: 50
                rotation: 135
                bg_start_angle: 0
                bg_end_angle: 270
                mode: NORMAL
                arc_width: 12
                indicator:
                  arc_color: 0x00FF00
                  arc_width: 12
                bg_arc_color: 0x1a1a2e

            - label:
                id: humidity_value_label
                x: 300
                y: 155
                width: 100
                text_align: CENTER
                text: "50%"
                text_color: 0x00FF00
                text_font: montserrat_20

        # =====================================================================
        # PAGE 3: Horizontal Scales (Progress Bars)
        # =====================================================================
        - id: horizontal_page
          bg_color: 0x0a0a14
          widgets:
            - label:
                x: 20
                y: 10
                text: "Horizontal Scales"
                text_color: 0xFFFFFF
                text_font: montserrat_18

            # Horizontal Top Scale
            - label:
                x: 20
                y: 50
                text: "HORIZONTAL_TOP:"
                text_color: 0x808080

            - scale:
                id: h_top_scale
                x: 20
                y: 80
                width: 400
                height: 60
                mode: HORIZONTAL_TOP
                min_value: 0
                max_value: 100
                ticks:
                  count: 11
                  width: 2
                  length: 10
                  color: 0x404040
                  major:
                    stride: 2
                    width: 3
                    length: 18
                    color: 0xFFFFFF
                    label_show: true
                sections:
                  - id: h_low
                    range_from: 0
                    range_to: 33
                    color: 0x0088FF
                    width: 4
                  - id: h_mid
                    range_from: 33
                    range_to: 66
                    color: 0x00FF88
                    width: 4
                  - id: h_high
                    range_from: 66
                    range_to: 100
                    color: 0xFF8800
                    width: 4

            # Horizontal Bottom Scale
            - label:
                x: 20
                y: 160
                text: "HORIZONTAL_BOTTOM:"
                text_color: 0x808080

            - scale:
                id: h_bottom_scale
                x: 20
                y: 190
                width: 400
                height: 60
                mode: HORIZONTAL_BOTTOM
                min_value: -50
                max_value: 50
                ticks:
                  count: 11
                  width: 2
                  length: 10
                  color: 0x404040
                  major:
                    stride: 2
                    width: 3
                    length: 18
                    color: 0xFFFFFF
                    label_show: true
                sections:
                  - id: h_neg
                    range_from: -50
                    range_to: 0
                    color: 0x00BFFF
                    width: 4
                  - id: h_pos
                    range_from: 0
                    range_to: 50
                    color: 0xFF4500
                    width: 4

        # =====================================================================
        # PAGE 4: Vertical Scales (Thermometer Style)
        # =====================================================================
        - id: vertical_page
          bg_color: 0x0a0a14
          widgets:
            - label:
                x: 20
                y: 10
                text: "Vertical Scales"
                text_color: 0xFFFFFF
                text_font: montserrat_18

            # Vertical Left Scale
            - label:
                x: 20
                y: 45
                text: "LEFT"
                text_color: 0x808080

            - scale:
                id: v_left_scale
                x: 60
                y: 70
                width: 80
                height: 200
                mode: VERTICAL_LEFT
                min_value: 0
                max_value: 100
                ticks:
                  count: 11
                  width: 2
                  length: 10
                  color: 0x404040
                  major:
                    stride: 2
                    width: 3
                    length: 18
                    color: 0xFFFFFF
                    label_show: true
                    label_gap: 6
                sections:
                  - id: v_low
                    range_from: 0
                    range_to: 30
                    color: 0x00BFFF
                    width: 4
                  - id: v_normal
                    range_from: 30
                    range_to: 70
                    color: 0x00FF00
                    width: 4
                  - id: v_high
                    range_from: 70
                    range_to: 100
                    color: 0xFF0000
                    width: 4

            # Vertical Right Scale
            - label:
                x: 200
                y: 45
                text: "RIGHT"
                text_color: 0x808080

            - scale:
                id: v_right_scale
                x: 180
                y: 70
                width: 80
                height: 200
                mode: VERTICAL_RIGHT
                min_value: -20
                max_value: 50
                ticks:
                  count: 15
                  width: 2
                  length: 10
                  color: 0x404040
                  major:
                    stride: 3
                    width: 3
                    length: 18
                    color: 0xFFFFFF
                    label_show: true
                    label_gap: 6
                sections:
                  - id: v_freeze
                    range_from: -20
                    range_to: 0
                    color: 0x00BFFF
                    width: 4
                  - id: v_comfort
                    range_from: 0
                    range_to: 25
                    color: 0x00FF00
                    width: 4
                  - id: v_hot
                    range_from: 25
                    range_to: 50
                    color: 0xFF4500
                    width: 4

            # Pressure Gauge (smaller, right side)
            - label:
                x: 320
                y: 45
                text: "Pressure"
                text_color: 0x808080

            - scale:
                id: pressure_scale
                x: 310
                y: 70
                width: 150
                height: 150
                mode: ROUND_OUTER
                min_value: 0
                max_value: 10
                rotation: 135
                angle_range: 270
                ticks:
                  count: 11
                  width: 2
                  length: 6
                  color: 0x404040
                  major:
                    stride: 2
                    width: 3
                    length: 12
                    color: 0xFFFFFF
                    label_show: true
                sections:
                  - id: p_low
                    range_from: 0
                    range_to: 3
                    color: 0x00FF00
                    width: 4
                  - id: p_mid
                    range_from: 3
                    range_to: 7
                    color: 0xFFFF00
                    width: 4
                  - id: p_high
                    range_from: 7
                    range_to: 10
                    color: 0xFF0000
                    width: 4

            - arc:
                id: pressure_arc
                x: 330
                y: 90
                width: 110
                height: 110
                min_value: 0
                max_value: 10
                value: 5
                rotation: 135
                bg_start_angle: 0
                bg_end_angle: 270
                mode: NORMAL
                arc_width: 10
                indicator:
                  arc_color: 0xFFFF00
                  arc_width: 10
                bg_arc_color: 0x1a1a2e

            - label:
                id: pressure_value_label
                x: 355
                y: 140
                width: 60
                text_align: CENTER
                text: "5 bar"
                text_color: 0xFFFF00
                text_font: montserrat_14

        # =====================================================================
        # PAGE 5: Home Assistant Integration (Real Sensors)
        # =====================================================================
        - id: ha_sensors_page
          bg_color: 0x0a0a14
          widgets:
            - label:
                x: 20
                y: 10
                text: "Home Assistant Sensors"
                text_color: 0xFFFFFF
                text_font: montserrat_18

            # Temperature from HA
            - scale:
                id: ha_temp_scale
                x: 30
                y: 60
                width: 200
                height: 200
                mode: ROUND_OUTER
                min_value: -10
                max_value: 40
                rotation: 135
                angle_range: 270
                ticks:
                  count: 11
                  width: 2
                  length: 8
                  color: 0x404040
                  major:
                    stride: 2
                    width: 3
                    length: 15
                    color: 0xFFFFFF
                    label_show: true
                sections:
                  - id: ha_cold
                    range_from: -10
                    range_to: 15
                    color: 0x00BFFF
                    width: 4
                  - id: ha_comfort
                    range_from: 15
                    range_to: 26
                    color: 0x00FF00
                    width: 4
                  - id: ha_warm
                    range_from: 26
                    range_to: 40
                    color: 0xFF4500
                    width: 4

            - arc:
                id: temp_arc
                x: 55
                y: 85
                width: 150
                height: 150
                min_value: -10
                max_value: 40
                value: 20
                rotation: 135
                bg_start_angle: 0
                bg_end_angle: 270
                mode: NORMAL
                arc_width: 12
                indicator:
                  arc_color: 0x00FF00
                  arc_width: 12
                bg_arc_color: 0x1a1a2e

            - label:
                id: temp_value_label
                x: 80
                y: 155
                width: 100
                text_align: CENTER
                text: "--.-째C"
                text_color: 0x00FF00
                text_font: montserrat_18

            - label:
                x: 80
                y: 180
                width: 100
                text_align: CENTER
                text: "Temperature"
                text_color: 0x808080

            # Humidity from HA
            - scale:
                id: ha_humid_scale
                x: 250
                y: 60
                width: 200
                height: 200
                mode: ROUND_OUTER
                min_value: 0
                max_value: 100
                rotation: 135
                angle_range: 270
                ticks:
                  count: 11
                  width: 2
                  length: 8
                  color: 0x404040
                  major:
                    stride: 2
                    width: 3
                    length: 15
                    color: 0xFFFFFF
                    label_show: true
                sections:
                  - id: ha_dry
                    range_from: 0
                    range_to: 30
                    color: 0xFFAA00
                    width: 4
                  - id: ha_ideal
                    range_from: 30
                    range_to: 60
                    color: 0x00FF00
                    width: 4
                  - id: ha_humid
                    range_from: 60
                    range_to: 100
                    color: 0x00BFFF
                    width: 4

            - arc:
                id: ha_humid_arc
                x: 275
                y: 85
                width: 150
                height: 150
                min_value: 0
                max_value: 100
                value: 50
                rotation: 135
                bg_start_angle: 0
                bg_end_angle: 270
                mode: NORMAL
                arc_width: 12
                indicator:
                  arc_color: 0x00FF00
                  arc_width: 12
                bg_arc_color: 0x1a1a2e

            - label:
                id: humid_value_label
                x: 300
                y: 155
                width: 100
                text_align: CENTER
                text: "--%"
                text_color: 0x00FF00
                text_font: montserrat_18

            - label:
                x: 300
                y: 180
                width: 100
                text_align: CENTER
                text: "Humidity"
                text_color: 0x808080

# =============================================================================
# TROUBLESHOOTING
# =============================================================================
#
# Scale not animating:
#   - Scale widget only displays ticks/labels (static)
#   - Use Arc widget overlaid on Scale for animated indicator
#   - Update the Arc value to animate the gauge
#
# Sections not showing:
#   - Check range_from and range_to are within min_value/max_value
#   - Make sure width > 0 for sections
#   - Verify color is valid hex (0xRRGGBB)
#
# Labels not showing:
#   - Set label_show: true in major ticks
#   - Increase label_gap if labels overlap with ticks
#   - Check that mode is set correctly
#
# Arc not aligned with Scale:
#   - Arc and Scale should have same rotation and angle_range
#   - Arc size should be smaller than Scale (to fit inside)
#   - Use same min_value/max_value for both
#
